exports.id=4242,exports.ids=[4242],exports.modules={5069:(e,t,r)=>{"use strict";r.d(t,{L:()=>s,db:()=>a});var i=r(56621);async function s(){return await (0,i.b)()}let a=(0,i.b)()},12909:(e,t,r)=>{"use strict";r.d(t,{HW:()=>o,hS:()=>n,rN:()=>g});var i=r(36463),s=r(56621);let a=new Map;async function o(){let e,t=await (0,s.b)(),{data:{session:r},error:o}=await t.auth.getSession();if(o||!r)return null;let n=r.user.id,g=r.user.email||"",u=`user:${n}`,l=a.get(u);if(l&&Date.now()-l.timestamp<6e4)return l.user;let{data:c,error:d}=await t.from("users").select("*").eq("id",n).single();if(c){let{data:r,error:s}=await t.from("users").update({email:g,updated_at:new Date().toISOString()}).eq("id",n).select("*").single();if(s)return i.v.error("Error updating user:",s),null;e=r}else{let{data:r,error:s}=await t.from("users").insert({id:n,email:g,subscription_tier:"FREE",role:"STUDENT",onboarding_completed:!1}).select("*").single();if(s)return i.v.error("Error creating user:",s),null;e=r}if(a.set(u,{user:e,timestamp:Date.now()}),a.size>50){let e=Date.now();for(let[t,r]of a.entries())e-r.timestamp>6e4&&a.delete(t)}return e}async function n(e){let t=await (0,s.b)(),{data:r}=await t.rpc("is_feature_active",{flag_name:"summer_promotion_2024"}),{data:a,error:o}=await t.from("users").select("*").eq("id",e).single();if(o||!a)return{canUse:!1,usedToday:0,limit:0};let n=new Date;n.setHours(0,0,0,0);let g=n.toISOString().split("T")[0],{data:u}=await t.from("usage_tracking").select("*").eq("user_id",e).eq("date",g).single(),l=u;if(!u){let{data:e,error:r}=await t.from("usage_tracking").insert({user_id:a.id,date:g,api_calls_used:0,tier:a.subscription_tier}).select("*").single();if(r)return i.v.error("Error creating usage tracking:",r),{canUse:!1,usedToday:0,limit:0};l=e}let c=r||"PRO"===a.subscription_tier?parseInt(process.env.PRO_TIER_DAILY_LIMIT||"200"):parseInt(process.env.FREE_TIER_DAILY_LIMIT||"20");return{canUse:(l?.api_calls_used||0)<c,usedToday:l?.api_calls_used||0,limit:c}}async function g(e){let t=await (0,s.b)(),r=new Date;r.setHours(0,0,0,0);let i=r.toISOString().split("T")[0],{data:a}=await t.from("usage_tracking").select("*").eq("user_id",e).eq("date",i).single();if(a)await t.from("usage_tracking").update({api_calls_used:a.api_calls_used+1}).eq("user_id",e).eq("date",i);else{let{data:r}=await t.from("users").select("subscription_tier").eq("id",e).single();await t.from("usage_tracking").insert({user_id:e,date:i,api_calls_used:1,tier:r?.subscription_tier||"FREE"})}}},36463:(e,t,r)=>{"use strict";r.d(t,{v:()=>s});class i{constructor(){this.logLevel=process.env.NEXT_PUBLIC_LOG_LEVEL||"info",this.setupProductionLogging()}static getInstance(){return i.instance||(i.instance=new i),i.instance}shouldLog(e){let t={debug:0,info:1,warn:2,error:3};return t[e]>=t[this.logLevel]}formatMessage(e,t,r){let i=new Date().toISOString(),s=r?` ${JSON.stringify(r)}`:"";return`[${i}] [${e.toUpperCase()}] ${t}${s}`}async setupProductionLogging(){try{let{getEnvVar:e}=await Promise.resolve().then(r.bind(r,43294)),t=await e("LOGGING_SERVICE");if("sentry"===t)await e("SENTRY_DSN")&&console.warn("Sentry logging not available in Cloudflare Workers environment");else if("logflare"===t){let t=await e("LOGFLARE_API_KEY"),r=await e("LOGFLARE_SOURCE_ID");t&&r&&console.warn("Winston-Logflare logging not available in Cloudflare Workers environment")}else if("datadog"===t){let t=await e("DATADOG_API_KEY");if(t){let{datadogLogs:e}=await r.e(6666).then(r.bind(r,96666));e.init({clientToken:t,site:"datadoghq.com",forwardErrorsToLogs:!0}),this.productionLogger=e}}}catch(e){console.error("Failed to initialize production logging:",e)}}debug(e,t){this.shouldLog("debug")&&console.debug(this.formatMessage("debug",e,t))}info(e,t){this.shouldLog("info")&&(console.info(this.formatMessage("info",e,t)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"info",t):this.productionLogger.logger&&this.productionLogger.logger.info(e,t)))}warn(e,t){this.shouldLog("warn")&&(console.warn(this.formatMessage("warn",e,t)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"warning",t):this.productionLogger.logger&&this.productionLogger.logger.warn(e,t)))}error(e,t,r){if(this.shouldLog("error")){let i=t?{error:t.message||t,stack:t.stack}:{};console.error(this.formatMessage("error",e,{...r,...i})),this.productionLogger&&(this.productionLogger.captureException?this.productionLogger.captureException(t||Error(e),{contexts:{context:r}}):this.productionLogger.logger&&this.productionLogger.logger.error(e,{...r,...i}))}}}let s=i.getInstance()},39727:()=>{},43294:(e,t,r)=>{"use strict";r.d(t,{getEnvVar:()=>a});var i=r(62426);async function s(){try{return(await (0,i.DM)()).env}catch(e){return process.env}}async function a(e){return(await s())[e]}},47990:()=>{},56621:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var i=r(66437),s=r(43294);let a=null;async function o(){if(!a){let e=await (0,s.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),t=await (0,s.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!t)throw Error("Missing Supabase configuration");a=(0,i.UU)(e,t)}return a}(0,i.UU)("https://tqlnqqrrpzmdpgijxiqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxbG5xcXJycHptZHBnaWp4aXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMTUwNjAsImV4cCI6MjA2NjY5MTA2MH0.ZDCY7DSswAgcUHFlDl3S0BDDXpX3qmyViWXsIGFhwkw")},78335:()=>{},96027:(e,t,r)=>{"use strict";r.d(t,{gF:()=>s,wS:()=>i}),r(76829);let i=e=>{},s=e=>{}},96487:()=>{}};