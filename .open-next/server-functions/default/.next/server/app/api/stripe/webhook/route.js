(()=>{var e={};e.id=3287,e.ids=[3287],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,t,r)=>{"use strict";r.d(t,{L:()=>i,db:()=>o});var s=r(56621);async function i(){return await (0,s.b)()}let o=(0,s.b)()},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},36463:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});class s{constructor(){this.logLevel=process.env.NEXT_PUBLIC_LOG_LEVEL||"info",this.setupProductionLogging()}static getInstance(){return s.instance||(s.instance=new s),s.instance}shouldLog(e){let t={debug:0,info:1,warn:2,error:3};return t[e]>=t[this.logLevel]}formatMessage(e,t,r){let s=new Date().toISOString(),i=r?` ${JSON.stringify(r)}`:"";return`[${s}] [${e.toUpperCase()}] ${t}${i}`}async setupProductionLogging(){try{let{getEnvVar:e}=await Promise.resolve().then(r.bind(r,43294)),t=await e("LOGGING_SERVICE");if("sentry"===t)await e("SENTRY_DSN")&&console.warn("Sentry logging not available in Cloudflare Workers environment");else if("logflare"===t){let t=await e("LOGFLARE_API_KEY"),r=await e("LOGFLARE_SOURCE_ID");t&&r&&console.warn("Winston-Logflare logging not available in Cloudflare Workers environment")}else if("datadog"===t){let t=await e("DATADOG_API_KEY");if(t){let{datadogLogs:e}=await r.e(6666).then(r.bind(r,96666));e.init({clientToken:t,site:"datadoghq.com",forwardErrorsToLogs:!0}),this.productionLogger=e}}}catch(e){console.error("Failed to initialize production logging:",e)}}debug(e,t){this.shouldLog("debug")&&console.debug(this.formatMessage("debug",e,t))}info(e,t){this.shouldLog("info")&&(console.info(this.formatMessage("info",e,t)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"info",t):this.productionLogger.logger&&this.productionLogger.logger.info(e,t)))}warn(e,t){this.shouldLog("warn")&&(console.warn(this.formatMessage("warn",e,t)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"warning",t):this.productionLogger.logger&&this.productionLogger.logger.warn(e,t)))}error(e,t,r){if(this.shouldLog("error")){let s=t?{error:t.message||t,stack:t.stack}:{};console.error(this.formatMessage("error",e,{...r,...s})),this.productionLogger&&(this.productionLogger.captureException?this.productionLogger.captureException(t||Error(e),{contexts:{context:r}}):this.productionLogger.logger&&this.productionLogger.logger.error(e,{...r,...s}))}}}let i=s.getInstance()},39727:()=>{},43294:(e,t,r)=>{"use strict";r.d(t,{getEnvVar:()=>o});var s=r(62426);async function i(){try{return(await (0,s.DM)()).env}catch(e){return process.env}}async function o(e){return(await i())[e]}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(66437),i=r(43294);let o=null;async function n(){if(!o){let e=await (0,i.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),t=await (0,i.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!t)throw Error("Missing Supabase configuration");o=(0,s.UU)(e,t)}return o}(0,s.UU)("https://tqlnqqrrpzmdpgijxiqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxbG5xcXJycHptZHBnaWp4aXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMTUwNjAsImV4cCI6MjA2NjY5MTA2MH0.ZDCY7DSswAgcUHFlDl3S0BDDXpX3qmyViWXsIGFhwkw")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76661:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>l,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>d});var i=r(96559),o=r(48088),n=r(37719);r(36463);var a=r(44999),u=r(96706),c=r(5069);r(55511);let p=new Map;async function d(e){let t;if(!function(e,t=100,r=6e4){let s=Date.now(),i=p.get(e);return!i||s>i.resetTime?(p.set(e,{count:1,resetTime:s+r}),!0):!(i.count>=t)&&(i.count++,!0)}(e.ip||e.headers.get("x-forwarded-for")||"127.0.0.1",50,6e4))return Response.json({error:"Too many requests"},{status:429});let r=await e.text(),s=(await (0,a.b3)()).get("stripe-signature");if(!s)return Response.json({error:"No signature"},{status:400});try{t=u._4.webhooks.constructEvent(r,s,process.env.STRIPE_WEBHOOK_SECRET)}catch(e){return Response.json({error:"Invalid signature"},{status:400})}try{switch(t.type){case"checkout.session.completed":{let e=t.data.object,r=await u._4.subscriptions.retrieve(e.subscription),s=await (0,c.L)();await s.from("users").update({stripe_customer_id:r.customer,stripe_subscription_id:r.id,subscription_status:"active",updated_at:new Date().toISOString()}).eq("id",e.metadata?.userId||"");break}case"invoice.payment_succeeded":case"invoice.payment_failed":default:break;case"customer.subscription.updated":{let e=t.data.object,r=await (0,c.L)();await r.from("users").update({subscription_status:"active"===e.status?"active":"canceled",updated_at:new Date().toISOString()}).eq("stripe_subscription_id",e.id);break}case"customer.subscription.deleted":{let e=t.data.object,r=await (0,c.L)();await r.from("users").update({subscription_status:"canceled",updated_at:new Date().toISOString()}).eq("stripe_subscription_id",e.id)}}return Response.json({received:!0})}catch(e){return Response.json({error:"Webhook handler failed"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"/home/new_username/Documents/projects/aiamrkerv2/worktrees/claude/src/app/api/stripe/webhook/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:f,serverHooks:h}=l;function w(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:f})}},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=o?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(s,n,a):s[n]=e[n]}return s.default=e,r&&r.set(e,s),s}(r(61120));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}let o={current:null},n="function"==typeof s.cache?s.cache:e=>e,a=console.warn;function u(e){return function(...t){a(e(...t))}}n(e=>{try{a(o.current)}finally{o.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)},96706:(e,t,r)=>{"use strict";r.d(t,{NB:()=>n,_4:()=>i,mV:()=>o});var s=r(97877);r(43294);let i=new s.A(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-06-30.basil",typescript:!0}),o={PRO_MONTHLY:process.env.STRIPE_PRO_MONTHLY_PRICE_ID||"price_1RksqiDb7SYU5gvXjID3h3H4",PRO_YEARLY:process.env.STRIPE_PRO_YEARLY_PRICE_ID||"price_1RksqiDb7SYU5gvXjID3h3H4"},n={FREE:{name:"Free",price:0,interval:"forever",features:["20 AI marks per day","Basic feedback","Progress tracking","Gemini AI model","Community support"],limits:{dailyMarks:20,providers:["gemini"]}},PRO:{name:"Pro",price:2.99,interval:"month",features:["200 AI marks per day","Advanced feedback with AO breakdown","Progress analytics","All AI models (Gemini, Kimi, DeepSeek)","OCR handwriting recognition","Export to Google Classroom","Priority support"],limits:{dailyMarks:200,providers:["gemini","kimi","deepseek"]}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,2822,4999,7877],()=>r(76661));module.exports=s})();