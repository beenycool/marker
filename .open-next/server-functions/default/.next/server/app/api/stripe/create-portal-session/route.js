(()=>{var e={};e.id=5344,e.ids=[5344],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,r,t)=>{"use strict";t.d(r,{L:()=>i,db:()=>o});var s=t(56621);async function i(){return await (0,s.b)()}let o=(0,s.b)()},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},36463:(e,r,t)=>{"use strict";t.d(r,{v:()=>i});class s{constructor(){this.logLevel=process.env.NEXT_PUBLIC_LOG_LEVEL||"info",this.setupProductionLogging()}static getInstance(){return s.instance||(s.instance=new s),s.instance}shouldLog(e){let r={debug:0,info:1,warn:2,error:3};return r[e]>=r[this.logLevel]}formatMessage(e,r,t){let s=new Date().toISOString(),i=t?` ${JSON.stringify(t)}`:"";return`[${s}] [${e.toUpperCase()}] ${r}${i}`}async setupProductionLogging(){try{let{getEnvVar:e}=await Promise.resolve().then(t.bind(t,43294)),r=await e("LOGGING_SERVICE");if("sentry"===r)await e("SENTRY_DSN")&&console.warn("Sentry logging not available in Cloudflare Workers environment");else if("logflare"===r){let r=await e("LOGFLARE_API_KEY"),t=await e("LOGFLARE_SOURCE_ID");r&&t&&console.warn("Winston-Logflare logging not available in Cloudflare Workers environment")}else if("datadog"===r){let r=await e("DATADOG_API_KEY");if(r){let{datadogLogs:e}=await t.e(6666).then(t.bind(t,96666));e.init({clientToken:r,site:"datadoghq.com",forwardErrorsToLogs:!0}),this.productionLogger=e}}}catch(e){console.error("Failed to initialize production logging:",e)}}debug(e,r){this.shouldLog("debug")&&console.debug(this.formatMessage("debug",e,r))}info(e,r){this.shouldLog("info")&&(console.info(this.formatMessage("info",e,r)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"info",r):this.productionLogger.logger&&this.productionLogger.logger.info(e,r)))}warn(e,r){this.shouldLog("warn")&&(console.warn(this.formatMessage("warn",e,r)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"warning",r):this.productionLogger.logger&&this.productionLogger.logger.warn(e,r)))}error(e,r,t){if(this.shouldLog("error")){let s=r?{error:r.message||r,stack:r.stack}:{};console.error(this.formatMessage("error",e,{...t,...s})),this.productionLogger&&(this.productionLogger.captureException?this.productionLogger.captureException(r||Error(e),{contexts:{context:t}}):this.productionLogger.logger&&this.productionLogger.logger.error(e,{...t,...s}))}}}let i=s.getInstance()},39727:()=>{},43294:(e,r,t)=>{"use strict";t.d(r,{getEnvVar:()=>o});var s=t(62426);async function i(){try{return(await (0,s.DM)()).env}catch(e){return process.env}}async function o(e){return(await i())[e]}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51641:(e,r,t)=>{"use strict";t.d(r,{P$:()=>u});var s=t(66437),i=t(44999),o=t(43294);async function n(){let e=await (0,o.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),r=await (0,o.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!r)throw Error("Missing Supabase configuration");let t=await (0,i.UL)();return(0,s.UU)(e,r,{auth:{storage:{getItem:e=>t.get(e)?.value||null,setItem:(e,r)=>{t.set(e,r,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800})},removeItem:e=>{t.delete(e)}}}})}async function a(){try{let e=await n(),{data:{session:r},error:t}=await e.auth.getSession();if(t||!r)return null;let s=r.user.id,i=r.user.email||"",{data:o}=await e.from("users").select("*").eq("id",s).single();if(o){let{data:r}=await e.from("users").update({email:i,updated_at:new Date().toISOString()}).eq("id",s).select("*").single();return r}{let{data:r}=await e.from("users").insert({id:s,email:i,subscription_tier:"FREE",role:"STUDENT",onboarding_completed:!1}).select("*").single();return r}}catch(e){return console.error("Error getting server user:",e),null}}async function u(){let e=await a();if(!e)throw Error("Authentication required");return e}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,r,t)=>{"use strict";t.d(r,{b:()=>n});var s=t(66437),i=t(43294);let o=null;async function n(){if(!o){let e=await (0,i.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),r=await (0,i.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!r)throw Error("Missing Supabase configuration");o=(0,s.UU)(e,r)}return o}(0,s.UU)("https://tqlnqqrrpzmdpgijxiqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxbG5xcXJycHptZHBnaWp4aXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMTUwNjAsImV4cCI6MjA2NjY5MTA2MH0.ZDCY7DSswAgcUHFlDl3S0BDDXpX3qmyViWXsIGFhwkw")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let s=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i(r);if(t&&t.has(e))return t.get(e);var s={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=o?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(s,n,a):s[n]=e[n]}return s.default=e,t&&t.set(e,s),s}(t(61120));function i(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(i=function(e){return e?t:r})(e)}let o={current:null},n="function"==typeof s.cache?s.cache:e=>e,a=console.warn;function u(e){return function(...r){a(e(...r))}}n(e=>{try{a(o.current)}finally{o.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},82842:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>g,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>p});var i=t(96559),o=t(48088),n=t(37719),a=t(36463),u=t(96706),c=t(5069),l=t(51641);let p=async()=>{try{let e=await (0,l.P$)(),r=await (0,c.L)(),{data:t,error:s}=await r.from("users").select("stripe_customer_id").eq("id",e.id).single();if(s||!t?.stripe_customer_id)return Response.json({error:"No Stripe customer found. Please create a subscription first."},{status:400});let i=await u._4.billingPortal.sessions.create({customer:t.stripe_customer_id,return_url:"https://aimarker.tech/settings"});return Response.json({url:i.url})}catch(e){return a.v.error("Portal session error:",e),Response.json({error:"Failed to create portal session"},{status:500})}},g=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/stripe/create-portal-session/route",pathname:"/api/stripe/create-portal-session",filename:"route",bundlePath:"app/api/stripe/create-portal-session/route"},resolvedPagePath:"/home/new_username/Documents/projects/aiamrkerv2/worktrees/claude/src/app/api/stripe/create-portal-session/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:h}=g;function m(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{},96559:(e,r,t)=>{"use strict";e.exports=t(44870)},96706:(e,r,t)=>{"use strict";t.d(r,{NB:()=>n,_4:()=>i,mV:()=>o});var s=t(97877);t(43294);let i=new s.A(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-06-30.basil",typescript:!0}),o={PRO_MONTHLY:process.env.STRIPE_PRO_MONTHLY_PRICE_ID||"price_1RksqiDb7SYU5gvXjID3h3H4",PRO_YEARLY:process.env.STRIPE_PRO_YEARLY_PRICE_ID||"price_1RksqiDb7SYU5gvXjID3h3H4"},n={FREE:{name:"Free",price:0,interval:"forever",features:["20 AI marks per day","Basic feedback","Progress tracking","Gemini AI model","Community support"],limits:{dailyMarks:20,providers:["gemini"]}},PRO:{name:"Pro",price:2.99,interval:"month",features:["200 AI marks per day","Advanced feedback with AO breakdown","Progress analytics","All AI models (Gemini, Kimi, DeepSeek)","OCR handwriting recognition","Export to Google Classroom","Priority support"],limits:{dailyMarks:200,providers:["gemini","kimi","deepseek"]}}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,2822,4999,7877],()=>t(82842));module.exports=s})();