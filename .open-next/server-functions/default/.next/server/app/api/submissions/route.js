(()=>{var e={};e.id=2865,e.ids=[2865],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,r,t)=>{"use strict";t.d(r,{L:()=>o,db:()=>a});var s=t(56621);async function o(){return await (0,s.b)()}let a=(0,s.b)()},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},26939:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>h,serverHooks:()=>y,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{DELETE:()=>m,GET:()=>f});var o=t(96559),a=t(48088),i=t(37719),n=t(72289),u=t(5069),c=t(51641),l=t(43091),d=t(47709),g=t(36463);let p=n.Ik({page:n.au.number().min(1).optional(),limit:n.au.number().min(1).max(100).optional(),subject:n.Yj().optional(),examBoard:n.Yj().optional(),hasGrade:n.au.boolean().optional(),sortBy:n.k5(["createdAt","score","grade"]).optional(),sortOrder:n.k5(["asc","desc"]).optional(),search:n.Yj().optional()}),f=async e=>{try{let r=await (0,c.P$)(),{searchParams:t}=new URL(e.url),s=(0,d.Rq)(p,t),o=s.page||1,a=Math.min(s.limit||20,100),i=(o-1)*a,n=await (0,u.L)(),f=n.from("submissions").select(`
        id,
        question,
        answer,
        subject,
        exam_board,
        mark_scheme,
        marks_total,
        created_at,
        feedback (
          id,
          score,
          grade,
          aos_met,
          improvement_suggestions,
          model_used,
          created_at
        )
      `).eq("user_id",r.id);s.subject&&(f=f.eq("subject",s.subject)),s.examBoard&&(f=f.eq("exam_board",s.examBoard)),s.search&&(f=f.or(`question.ilike.%${s.search}%,answer.ilike.%${s.search}%`)),f=(f="createdAt"===s.sortBy?f.order("created_at",{ascending:"asc"===s.sortOrder}):f.order("created_at",{ascending:!1})).range(i,i+a-1);let{data:m,error:h}=await f;if(h)return g.v.error("Supabase error",h,{userId:r.id}),(0,l.yj)("Failed to fetch submissions",500);let b=n.from("submissions").select("*",{count:"exact",head:!0}).eq("user_id",r.id);s.subject&&(b=b.eq("subject",s.subject)),s.examBoard&&(b=b.eq("exam_board",s.examBoard)),s.search&&(b=b.or(`question.ilike.%${s.search}%,answer.ilike.%${s.search}%`));let{count:w,error:y}=await b;if(y)return g.v.error("Supabase count error",y,{userId:r.id}),(0,l.yj)("Failed to count submissions",500);let _=m||[];void 0!==s.hasGrade&&(_=_.filter(e=>{let r=e.feedback&&e.feedback.length>0;return s.hasGrade?r:!r})),"score"===s.sortBy?_.sort((e,r)=>{let t=e.feedback?.[0]?.score||0,o=r.feedback?.[0]?.score||0;return"asc"===s.sortOrder?t-o:o-t}):"grade"===s.sortBy&&_.sort((e,r)=>{let t=e.feedback?.[0]?.grade||"",o=r.feedback?.[0]?.grade||"";return"asc"===s.sortOrder?t.localeCompare(o):o.localeCompare(t)});let v=_.map(e=>({id:e.id,question:e.question,answer:e.answer,subject:e.subject,examBoard:e.exam_board,markScheme:e.mark_scheme,marksTotal:e.marks_total,createdAt:e.created_at,feedback:e.feedback?.[0]||null}));return(0,l.r6)({submissions:v,pagination:{page:o,limit:a,totalCount:w||0,totalPages:Math.ceil((w||0)/a),hasNextPage:o*a<(w||0),hasPreviousPage:o>1}})}catch(e){return(0,l.yj)("Authentication required",401)}},m=async e=>{try{let r=await (0,c.P$)(),{searchParams:t}=new URL(e.url),s=t.get("id");if(!s)return(0,l.yj)("Submission ID is required",400);let o=await (0,u.L)(),{data:a,error:i}=await o.from("submissions").select("id").eq("id",s).eq("user_id",r.id).single();if(i||!a)return(0,l.HN)("Submission not found");let{error:n}=await o.from("submissions").delete().eq("id",s);if(n)return g.v.error("Supabase delete error",n,{submissionId:s}),(0,l.yj)("Failed to delete submission",500);return(0,l.r6)(null,"Submission deleted successfully")}catch(e){return(0,l.yj)("Authentication required",401)}},h=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/submissions/route",pathname:"/api/submissions",filename:"route",bundlePath:"app/api/submissions/route"},resolvedPagePath:"/home/new_username/Documents/projects/aiamrkerv2/worktrees/claude/src/app/api/submissions/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:b,workUnitAsyncStorage:w,serverHooks:y}=h;function _(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:w})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},36463:(e,r,t)=>{"use strict";t.d(r,{v:()=>o});class s{constructor(){this.logLevel=process.env.NEXT_PUBLIC_LOG_LEVEL||"info",this.setupProductionLogging()}static getInstance(){return s.instance||(s.instance=new s),s.instance}shouldLog(e){let r={debug:0,info:1,warn:2,error:3};return r[e]>=r[this.logLevel]}formatMessage(e,r,t){let s=new Date().toISOString(),o=t?` ${JSON.stringify(t)}`:"";return`[${s}] [${e.toUpperCase()}] ${r}${o}`}async setupProductionLogging(){try{let{getEnvVar:e}=await Promise.resolve().then(t.bind(t,43294)),r=await e("LOGGING_SERVICE");if("sentry"===r)await e("SENTRY_DSN")&&console.warn("Sentry logging not available in Cloudflare Workers environment");else if("logflare"===r){let r=await e("LOGFLARE_API_KEY"),t=await e("LOGFLARE_SOURCE_ID");r&&t&&console.warn("Winston-Logflare logging not available in Cloudflare Workers environment")}else if("datadog"===r){let r=await e("DATADOG_API_KEY");if(r){let{datadogLogs:e}=await t.e(6666).then(t.bind(t,96666));e.init({clientToken:r,site:"datadoghq.com",forwardErrorsToLogs:!0}),this.productionLogger=e}}}catch(e){console.error("Failed to initialize production logging:",e)}}debug(e,r){this.shouldLog("debug")&&console.debug(this.formatMessage("debug",e,r))}info(e,r){this.shouldLog("info")&&(console.info(this.formatMessage("info",e,r)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"info",r):this.productionLogger.logger&&this.productionLogger.logger.info(e,r)))}warn(e,r){this.shouldLog("warn")&&(console.warn(this.formatMessage("warn",e,r)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"warning",r):this.productionLogger.logger&&this.productionLogger.logger.warn(e,r)))}error(e,r,t){if(this.shouldLog("error")){let s=r?{error:r.message||r,stack:r.stack}:{};console.error(this.formatMessage("error",e,{...t,...s})),this.productionLogger&&(this.productionLogger.captureException?this.productionLogger.captureException(r||Error(e),{contexts:{context:t}}):this.productionLogger.logger&&this.productionLogger.logger.error(e,{...t,...s}))}}}let o=s.getInstance()},39727:()=>{},43091:(e,r,t)=>{"use strict";t.d(r,{HN:()=>i,r6:()=>o,yj:()=>a});var s=t(32190);function o(e,r,t=200){return s.NextResponse.json({success:!0,data:e,message:r,statusCode:t},{status:t})}function a(e,r=500,t){return s.NextResponse.json({success:!1,error:e,data:t,statusCode:r},{status:r})}function i(e="Not found"){return a(e,404)}},43294:(e,r,t)=>{"use strict";t.d(r,{getEnvVar:()=>a});var s=t(62426);async function o(){try{return(await (0,s.DM)()).env}catch(e){return process.env}}async function a(e){return(await o())[e]}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47709:(e,r,t)=>{"use strict";function s(e,r){return e.parse(r)}function o(e,r){let t=Object.fromEntries(r);return e.parse(t)}t.d(r,{Rq:()=>o,sv:()=>s}),t(43091)},47990:()=>{},51641:(e,r,t)=>{"use strict";t.d(r,{P$:()=>u});var s=t(66437),o=t(44999),a=t(43294);async function i(){let e=await (0,a.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),r=await (0,a.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!r)throw Error("Missing Supabase configuration");let t=await (0,o.UL)();return(0,s.UU)(e,r,{auth:{storage:{getItem:e=>t.get(e)?.value||null,setItem:(e,r)=>{t.set(e,r,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800})},removeItem:e=>{t.delete(e)}}}})}async function n(){try{let e=await i(),{data:{session:r},error:t}=await e.auth.getSession();if(t||!r)return null;let s=r.user.id,o=r.user.email||"",{data:a}=await e.from("users").select("*").eq("id",s).single();if(a){let{data:r}=await e.from("users").update({email:o,updated_at:new Date().toISOString()}).eq("id",s).select("*").single();return r}{let{data:r}=await e.from("users").insert({id:s,email:o,subscription_tier:"FREE",role:"STUDENT",onboarding_completed:!1}).select("*").single();return r}}catch(e){return console.error("Error getting server user:",e),null}}async function u(){let e=await n();if(!e)throw Error("Authentication required");return e}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,r,t)=>{"use strict";t.d(r,{b:()=>i});var s=t(66437),o=t(43294);let a=null;async function i(){if(!a){let e=await (0,o.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),r=await (0,o.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!r)throw Error("Missing Supabase configuration");a=(0,s.UU)(e,r)}return a}(0,s.UU)("https://tqlnqqrrpzmdpgijxiqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxbG5xcXJycHptZHBnaWp4aXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMTUwNjAsImV4cCI6MjA2NjY5MTA2MH0.ZDCY7DSswAgcUHFlDl3S0BDDXpX3qmyViWXsIGFhwkw")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let s=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o(r);if(t&&t.has(e))return t.get(e);var s={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var n=a?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(s,i,n):s[i]=e[i]}return s.default=e,t&&t.set(e,s),s}(t(61120));function o(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(o=function(e){return e?t:r})(e)}let a={current:null},i="function"==typeof s.cache?s.cache:e=>e,n=console.warn;function u(e){return function(...r){n(e(...r))}}i(e=>{try{n(a.current)}finally{a.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,2822,580,2289,4999],()=>t(26939));module.exports=s})();