(()=>{var e={};e.id=3070,e.ids=[3070],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,t,r)=>{"use strict";r.d(t,{L:()=>o,db:()=>n});var s=r(56621);async function o(){return await (0,s.b)()}let n=(0,s.b)()},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},36463:(e,t,r)=>{"use strict";r.d(t,{v:()=>o});class s{constructor(){this.logLevel=process.env.NEXT_PUBLIC_LOG_LEVEL||"info",this.setupProductionLogging()}static getInstance(){return s.instance||(s.instance=new s),s.instance}shouldLog(e){let t={debug:0,info:1,warn:2,error:3};return t[e]>=t[this.logLevel]}formatMessage(e,t,r){let s=new Date().toISOString(),o=r?` ${JSON.stringify(r)}`:"";return`[${s}] [${e.toUpperCase()}] ${t}${o}`}async setupProductionLogging(){try{let{getEnvVar:e}=await Promise.resolve().then(r.bind(r,43294)),t=await e("LOGGING_SERVICE");if("sentry"===t)await e("SENTRY_DSN")&&console.warn("Sentry logging not available in Cloudflare Workers environment");else if("logflare"===t){let t=await e("LOGFLARE_API_KEY"),r=await e("LOGFLARE_SOURCE_ID");t&&r&&console.warn("Winston-Logflare logging not available in Cloudflare Workers environment")}else if("datadog"===t){let t=await e("DATADOG_API_KEY");if(t){let{datadogLogs:e}=await r.e(6666).then(r.bind(r,96666));e.init({clientToken:t,site:"datadoghq.com",forwardErrorsToLogs:!0}),this.productionLogger=e}}}catch(e){console.error("Failed to initialize production logging:",e)}}debug(e,t){this.shouldLog("debug")&&console.debug(this.formatMessage("debug",e,t))}info(e,t){this.shouldLog("info")&&(console.info(this.formatMessage("info",e,t)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"info",t):this.productionLogger.logger&&this.productionLogger.logger.info(e,t)))}warn(e,t){this.shouldLog("warn")&&(console.warn(this.formatMessage("warn",e,t)),this.productionLogger&&(this.productionLogger.captureMessage?this.productionLogger.captureMessage(e,"warning",t):this.productionLogger.logger&&this.productionLogger.logger.warn(e,t)))}error(e,t,r){if(this.shouldLog("error")){let s=t?{error:t.message||t,stack:t.stack}:{};console.error(this.formatMessage("error",e,{...r,...s})),this.productionLogger&&(this.productionLogger.captureException?this.productionLogger.captureException(t||Error(e),{contexts:{context:r}}):this.productionLogger.logger&&this.productionLogger.logger.error(e,{...r,...s}))}}}let o=s.getInstance()},39727:()=>{},43091:(e,t,r)=>{"use strict";r.d(t,{HN:()=>i,r6:()=>o,yj:()=>n});var s=r(32190);function o(e,t,r=200){return s.NextResponse.json({success:!0,data:e,message:t,statusCode:r},{status:r})}function n(e,t=500,r){return s.NextResponse.json({success:!1,error:e,data:r,statusCode:t},{status:t})}function i(e="Not found"){return n(e,404)}},43294:(e,t,r)=>{"use strict";r.d(t,{getEnvVar:()=>n});var s=r(62426);async function o(){try{return(await (0,s.DM)()).env}catch(e){return process.env}}async function n(e){return(await o())[e]}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51641:(e,t,r)=>{"use strict";r.d(t,{P$:()=>c});var s=r(66437),o=r(44999),n=r(43294);async function i(){let e=await (0,n.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),t=await (0,n.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!t)throw Error("Missing Supabase configuration");let r=await (0,o.UL)();return(0,s.UU)(e,t,{auth:{storage:{getItem:e=>r.get(e)?.value||null,setItem:(e,t)=>{r.set(e,t,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800})},removeItem:e=>{r.delete(e)}}}})}async function a(){try{let e=await i(),{data:{session:t},error:r}=await e.auth.getSession();if(r||!t)return null;let s=t.user.id,o=t.user.email||"",{data:n}=await e.from("users").select("*").eq("id",s).single();if(n){let{data:t}=await e.from("users").update({email:o,updated_at:new Date().toISOString()}).eq("id",s).select("*").single();return t}{let{data:t}=await e.from("users").insert({id:s,email:o,subscription_tier:"FREE",role:"STUDENT",onboarding_completed:!1}).select("*").single();return t}}catch(e){return console.error("Error getting server user:",e),null}}async function c(){let e=await a();if(!e)throw Error("Authentication required");return e}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});var s=r(66437),o=r(43294);let n=null;async function i(){if(!n){let e=await (0,o.getEnvVar)("NEXT_PUBLIC_SUPABASE_URL"),t=await (0,o.getEnvVar)("NEXT_PUBLIC_SUPABASE_ANON_KEY");if(!e||!t)throw Error("Missing Supabase configuration");n=(0,s.UU)(e,t)}return n}(0,s.UU)("https://tqlnqqrrpzmdpgijxiqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxbG5xcXJycHptZHBnaWp4aXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMTUwNjAsImV4cCI6MjA2NjY5MTA2MH0.ZDCY7DSswAgcUHFlDl3S0BDDXpX3qmyViWXsIGFhwkw")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return c}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=n?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(s,i,a):s[i]=e[i]}return s.default=e,r&&r.set(e,s),s}(r(61120));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}let n={current:null},i="function"==typeof s.cache?s.cache:e=>e,a=console.warn;function c(e){return function(...t){a(e(...t))}}i(e=>{try{a(n.current)}finally{n.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{},97022:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>f,serverHooks:()=>b,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>p});var o=r(96559),n=r(48088),i=r(37719),a=r(36463),c=r(5069),u=r(51641),l=r(43091);let g=(e,t)=>{let r=new Date(e);return r.setDate(r.getDate()-t),r},d=(e,t)=>e.toISOString().split("T")[0],p=async e=>{try{let t=await (0,u.P$)(),{searchParams:r}=new URL(e.url),s=parseInt(r.get("days")||"30"),o=g(new Date,s),n=await (0,c.L)(),{data:i,error:p}=await n.from("submissions").select(`
        *,
        feedback (*)
      `).eq("user_id",t.id).gte("created_at",o.toISOString()).order("created_at",{ascending:!1});if(p)return a.v.error("Supabase submissions query error:",p),Response.json({error:"Failed to fetch submissions"},{status:500});let f=i.length,h=i.filter(e=>e.feedback&&e.feedback.length>0),w=h.length>0?h.reduce((e,t)=>e+(t.feedback[0]?.score||0),0)/h.length:0,b={};i.forEach(e=>{let t=e.subject||"Unknown";b[t]=(b[t]||0)+1});let m={"A*":0,A:0,B:0,C:0,D:0,E:0,F:0};h.forEach(e=>{let t=e.feedback[0]?.grade||"F";void 0!==m[t]&&m[t]++});let y=[],v={};h.forEach(e=>{let t=d(new Date(e.created_at),"yyyy-MM-dd");v[t]||(v[t]={scores:[],count:0}),v[t].scores.push(e.feedback[0]?.score||0),v[t].count++}),Object.entries(v).forEach(([e,t])=>{let r=t.scores.length>0?t.scores.reduce((e,t)=>e+t,0)/t.scores.length:0;y.push({date:e,score:Math.round(10*r)/10,count:t.count})}),y.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());let E=i.slice(0,10).map(e=>({id:e.id,question:e.question.length>100?e.question.substring(0,100)+"...":e.question,subject:e.subject,examBoard:e.exam_board,score:e.feedback[0]?.score||null,grade:e.feedback[0]?.grade||null,createdAt:e.created_at,feedback:e.feedback[0]?{id:e.feedback[0].id,score:e.feedback[0].score,grade:e.feedback[0].grade,aosMet:e.feedback[0].aos_met,improvementSuggestions:e.feedback[0].improvement_suggestions.slice(0,2)}:null})),L=function(e){let t=[];if(e.progressOverTime.length>=2){let r=e.progressOverTime.slice(-5),s=e.progressOverTime.slice(0,-5);if(r.length>0&&s.length>0){let e=r.reduce((e,t)=>e+t.score,0)/r.length,o=s.reduce((e,t)=>e+t.score,0)/s.length;e>o+2?t.push({type:"positive",title:"Improving Performance",description:`Your average score has increased by ${(e-o).toFixed(1)} points recently.`,icon:"trending-up"}):e<o-2&&t.push({type:"warning",title:"Performance Dip",description:`Your recent scores are ${(o-e).toFixed(1)} points lower than before.`,icon:"trending-down"})}}let r=Object.entries(e.subjectBreakdown).sort(([,e],[,t])=>t-e)[0];r&&t.push({type:"info",title:"Most Practiced Subject",description:`You've submitted ${r[1]} questions in ${r[0]}.`,icon:"book-open"});let s=(e.gradeDistribution["A*"]||0)+(e.gradeDistribution.A||0),o=Object.values(e.gradeDistribution).reduce((e,t)=>e+t,0);if(o>0){let e=s/o*100;e>=60&&t.push({type:"positive",title:"Excellent Performance",description:`${e.toFixed(0)}% of your work achieved A* or A grades.`,icon:"award"})}return e.progressOverTime.length>=5&&10>function(e){let t=e.reduce((e,t)=>e+t,0)/e.length;return e.map(e=>Math.pow(e-t,2)).reduce((e,t)=>e+t,0)/e.length}(e.progressOverTime.map(e=>e.score))&&t.push({type:"positive",title:"Consistent Performance",description:"Your scores show good consistency over time.",icon:"target"}),t}({totalSubmissions:f,averageScore:w,subjectBreakdown:b,gradeDistribution:m,progressOverTime:y,recentSubmissions:E});return(0,l.r6)({analytics:{totalSubmissions:f,averageScore:w,subjectBreakdown:b,gradeDistribution:m,progressOverTime:y,insights:L},recentSubmissions:E,period:{days:s,startDate:o.toISOString(),endDate:new Date().toISOString()}})}catch(e){return a.v.error("Analytics API error:",e),Response.json({error:"Failed to fetch analytics"},{status:500})}},f=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"/home/new_username/Documents/projects/aiamrkerv2/worktrees/claude/src/app/api/analytics/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:b}=f;function m(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,2822,580,4999],()=>r(97022));module.exports=s})();